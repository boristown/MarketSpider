// File: table-range-filters.js
!function(){var a,b,c=$(".js-table-filter-container").detach(),d=$(".js-filter-popup").detach();window.getTableRangeFilterTemplate=function(){return c},window.TableRangeFilters=function(e,f,g,h,i){function j(){a&&k(a)}function k(a){var c=K[a];if(H!==a){p(),b=d.clone();var e=F[a][0],f=F[a][1],g=!!G[a],h=e,i=f;g&&(h=G[a][0],i=G[a][1]),H=a,b.find(".js-clear-button").on("click",function(){m(!0,H)}),t(e,f,x(a,e,f)),s(),A.setSliderValues(e,f,h,i),b.find(".js-filter-header").text($(C.eq(a).contents()[0]).text()),c.after(b._show()).addClass("hover")}}function l(){var b,d;for(b in f.cols)d=c.clone(),d.on("click",$.stopProp),K[b]=d.find(".js-filter-icon"),function(b){i?K[b].on("click",function(){a=b}):K[b].on("click",function(){k(b)})}(b),G[b]&&d.find(".js-filter-icon").addClass("active"),C.eq(b).append(d.show())}function m(a,b){delete G[b],delete L[b],o(b,F[b][0],F[b][1],!0,a)}function n(){for(var a in G)m(!0,a)}function o(a,b,c,d,e){C.eq(a).find(".js-filter-icon").toggleClass("active",!d),e||(G[a]=[b,c]),y(),D.trigger("filterApplied",a),I(),e&&p()}function p(){~H&&K[H].removeClass("hover"),b&&b.remove(),H=-1}function q(a){var b,c;for(b in f.cols)c=B.find("td:eq("+b+")").map(function(){return f.cols[b].formatter($(this).text())}),F[b]=[Math.floor(Math.min.apply(null,c)),Math.ceil(Math.max.apply(null,c))],G[b]&&!a&&(G[b]=[Math.max(G[b][0],F[b][0]),Math.min(G[b][1],F[b][1])]);return this}function r(){D.off("removeRangeFilterWidget").on("removeRangeFilterWidget",function(){m(!1,H)}),$(document.body).off("mousedown.closeFilterPopup").on("mousedown.closeFilterPopup",p)}function s(){A&&A.onEvent("slide",function(a,b,c){!~H||F[H][0]===c[0]&&F[H][1]===c[1]||J(H,c[0],c[1])})}function t(a,c,d){A=window.initRangeFilter(a,c,b.find(".js-crypto-range-filter"),"crypto",wNumb({}),d)}function u(a){return a.filter(function(a,b,c){return!~c.indexOf(a,b+1)})}function v(a,b){return a-b}function w(a,b,c){var d,e=Math.min(a.length,100),f=100/e,g=a.length/e,h={min:b,max:c};for(d=1;d<e;d++)h[d*f+"%"]=a[Math.floor(g*d)];return h}function x(a,b,c){if(!L[a]){var d,e=[],g=[];B.filter(":visible").each(function(b,c){e.push(f.cols[a].formatter($(c).find("TD").eq(a).text()))}),e.sort(v),g=u(e),d=w(g,b,c),L[a]=d}return L[a]}function y(){B.each(function(a,b){var c,d,e,g=$(b),h=E(g);for(c in G)h&&(d=g.find("td").eq(c),e=f.cols[c].formatter(d.text()),h&=e.between(G[c][0],G[c][1]));g._toggleShow(h)})}function z(){q(h),l(),g||r(),y()}var A,B=e.find("TBODY TR"),C=e.find("THEAD TH"),D=$(window),E=f.extraValidation||function(){return!0},F={},G=f.userFilters||{},H=-1,I=f.saveFiltersToServer?$.debounce(f.saveFiltersToServer,2e3):$.noop,J=$.debounce(o,250),K={},L={};return this.refreshTableInDOM=y,this.reevaluateLimits=q,this.openLastClickedIfExists=j,this.clearAllFilters=n,this.getFilterStates=function(){return G},this.updateSettings=function(a){f=$.extend(f,a)},this.getMinMaxValues=function(){return F},z(),this}}();