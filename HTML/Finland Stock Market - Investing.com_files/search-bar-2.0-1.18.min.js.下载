"use strict";!function(a){function b(){var a=V.val().trim();Ea.isnt(a)&&(Ba=!a,Ea=a,a?Fa(a):(L(),u(!0),Y.empty(),da.empty()))}function c(){V.is(":focus")&&N()}function d(){c(),V.on("focus",N).on("keyup",b)}function e(){window.location.pathname.is(sa)&&(Ca=!1,V.one("mouseenter",function(){var a=V.val().trim();a?o(a,!1,function(){Ca=!0,c()}):Ca=!0})),d(),fa.on("click",function(){var a=V.val().trim();a&&(window.location.href="/search/?q="+a)})}function f(){wa.on("mousedown",function(a){O()}),T.on("mousedown",function(a){g(!1),$.stopProp(a)})}function g(a){na._toggleShow(a),ma.toggleClass("focus",a)}function h(){ma.on("mousedown",function(a){1===a.which&&(g(),$.stopProp(a))}).on("mouseenter",function(){var a=V.val().trim(),b=Ga.get(a);b&&!b.isMoreQuotesWasLoaded&&(b.isMoreQuotesWasLoaded=!0,A(a,Ga.get(a).quotes.length,300,function(c){var d=void 0;d=c.quotes.filter(function(a){return!Ha.isStoredAndStore(a.pairId)}),b.quotes=b.quotes.concat(d),Ga.set(a,b),k(d).length&&Da.isnt("All")&&n(b.quotes,a)}))}),na.find("li").on("mousedown",function(a){var b,c;1===a.which&&(b=$(this),c=b.data("value"),oa.text(b.text()),Da=c,g(!1),o(V.val().trim(),!0)),$.stopProp(a)})}function i(){wa.on("keydown.topBarSearchArrows",function(a){switch(a.keyCode){case 13:~xa?D(pa[xa]):window.location.href="/search/?q="+V.val().trim();break;case 27:V.blur(),O();break;case 38:s(),q(),a.preventDefault();break;case 40:r(),q(),a.preventDefault()}})}function j(){wa.off("keydown.topBarSearchArrows")}function k(a){return Da.is("All")?a:a.filter(function(a){return Da.is("crypto")?a.isCrypto:a.pair_type.is(Da)&&!a.isCrypto})}function l(a){return a&&a.length}function m(a,b,c){b.length>=3&&a&&a.find(c).each(function(a,c){$(c).text().has(b)&&$(c).html(function(a,c){return c.replace(new RegExp("("+b+")","gi"),'<i class="bold">$1</i>')})})}function n(a,b){var c,d;d=k(a),c=d.reduce(H,null),m(c,b,".js-quote-item-name, .js-quote-item-symbol"),Y.html(c),C(X,d),_._toggleShow(!d.length),Z.__toggleShow(d.length)}function o(a,b,c){B(a,function(d){var e=0;if(xa=-1,!Ba){if(n(d.quotes,a),!b){var f=void 0,g=$.extend({},d.score);for(da.empty();(f=p(g))&&e!==za;)~ua.indexOf(f)||(e+=+!!G(d[f],va[f],da,!0));da.__toggleShow(!!e)}M(),K(a),$.run(c)}})}function p(a){var b=void 0,c=0;return $.each(a,function(a,d){c<d&&(c=d,b=a)}),delete a[b],b}function q(){var a,b=Z.height(),c=Ia.eq(xa),d=c.height();Z.is(":visible")&&!$.isInView(c,!1,0,Z)&&(a=c.index()*d>Z.scrollTop(),Z.scrollTop(c.index()*d-+a*(b-d)))}function r(){xa<Ia.length-1&&(xa++,t())}function s(){xa>0&&(xa--,t())}function t(){u(),Ia.eq(xa).addClass("hover")}function u(a){Ia.removeClass("hover"),a&&(xa=-1)}function v(a,b){var c=-1;return a.forEach(function(a,d){a.pairId==b&&(c=d)}),c}function w(a){var b=x(),c=v(b,a.pairId);(b.length===ya||~c)&&b.splice(c,1),b.unshift(a),Storage.set("recentSearches",b)}function x(){return[].concat(Storage.get("recentSearches")||[])}function y(){var a=getCookie("searchedResults");a&&(Storage.set("recentSearches",JSON.parse(a).map(function(a){return a.name=decodeURIComponent(a.name),a.type=decodeURIComponent(a.type),a})),setCookie("searchedResults",""))}function z(){var b,c=x();b=G(c,"recent",ca),G(a.popularSearches,"popular",ca),b<3?ga.remove():b<5&&ga.find(".js-popular-analysis-items>*").last().remove(),qa=c.concat(a.popularSearches)}function A(a,b,c,d){$.ajax({type:"POST",url:"/search/service/searchTopBar",data:{search_text:a,type:"quotes",offset:b,limit:c},success:function(a){d(a)},dataType:"json",cache:!1})}function B(a,b){Ga.get(a)?b(Ga.get(a)):$.ajax({type:"POST",url:"/search/service/searchTopBar",data:{search_text:a},success:function(c){Ga.set(a,c),Ha.clear().store(c.quotes.map(function(a){return a.pairId})),b(c)},dataType:"json",cache:!1})}function C(a,b){Ia=a.find(".js-quote-item"),pa=b}function D(a){w(a),F(a),window.location.href=a.link}function E(a,b){a.on("mousedown",function(a){3!==a.which&&(xa=$(this).index(),t(),w(b),F(b),$.run(window.ga,"allSitesTracker.send","event","Site Search","Search",b.name,{metric2:1,dimension23:b.name}))})}function F(a){Ea&&a.pairId&&$.post(Ja,{searchString:Ea,clickedResult:a.pairId})}function G(a,b,c,d){var e,f=ta[b],g=f.$wrapper.clone(),h=f.gaAction,i=f.link+"q="+V.val().trim(),j=0;return l(a)&&(e=a.slice(0,f.itemsLimit).reduce(f.renderRowFunction,null).on("click",d?Q("Side Box",h+" - Article"):$.noop),g.find(".js-group-more-link").attr("href",i).on("click",d?Q("Side Box",h+" - More"):$.noop),g.find(".js-group-title").text(f.title).on("click",function(a){d&&(Q("Side Box",h)(),$.stopProp(a))}),g.find(".js-group-results").html(e),b.is("news")&&g.find(".js-group-results").removeClass("smallTitle1 analysisImg").addClass("mediumTitle1"),c.append(g),j=e.length),j}function H(a,b){var c=ha.clone().attr("href",b.link).data("id",b.pairId);return c.find(".js-quote-item-symbol").text(b.symbol),c.find(".js-quote-item-name").text(b.name||"").attr("title",b.name),c.find(".js-quote-item-type").text($.capitalizeFirst(b.type,!0).replace("Etf - ","ETF - ")),c.find(".js-quote-item-flag").addClass(b.flag),E(c,b),a?a.add(c):c}function I(a,b){var c=ka.clone();return c.find(".js-news-item-link").attr("href",b.link),c.find(".js-news-item-img").attr("src",b.image),c.find(".js-news-item-name").attr("href",b.link).attr("title",b.name).text(b.name.trim()),a?a.add(c):c}function J(a,b){var c=la.clone();return c.find(".js-tool-item-link").attr("href",b.link),c.find(".js-tool-item-name").attr("title",b.name).text(b.name),a?a.add(c):c}function K(a){ea.attr("href","/search/?q="+a).find(".js-footer-link-text").text(a),aa.attr("href","/search/?q="+a+"&tab=quotes")}function L(){ba.__show(),X.__hide(),C(ba,qa)}function M(){ba.__hide(),X.__show()}function N(){!Aa&&Ca&&P(!0)}function O(){Aa&&(P(!1),u(!0))}function P(a){W._toggleShow(a),U._toggleShow(a),Aa=a,a?i():j()}function Q(a,b){return function(){$.run(window.ga,"allSitesTracker.send","event","Site Search",a,b)}}function R(){T.find(".js-search-ga-more").on("click",function(){Q("Side Box",$(this).attr("ga-label"))()}),T.find(".js-search-ga-header").on("click",function(){Q("Side Box",$(this).attr("ga-label"))()})}function S(){e(),f(),h(),R(),y(),z(),L()}var T=$(".js-main-search-wrapper"),U=$(".js-search-overlay"),V=T.find(".js-main-search-bar"),W=T.find(".js-results-dialog"),X=T.find(".js-query-results"),Y=X.find(".js-table-results"),Z=T.find(".js-scrollable-results-wrapper"),_=T.find(".js-query-no-results"),aa=T.find(".js-quote-header-link"),ba=T.find(".js-default-search-results"),ca=T.find(".js-main-group-results"),da=T.find(".js-right-side-results"),ea=X.find(".js-footer-link"),fa=T.find(".js-magnifying-glass-icon"),ga=T.find(".js-popular-analysis-wrapper"),ha=T.find(".js-quote-row-template").detach()._show(),ia=T.find(".js-group-template").detach()._show(),ja=T.find(".js-news-items-group-template").detach()._show(),ka=T.find(".js-news-item-template").detach()._show(),la=T.find(".js-tool-item-template").detach()._show(),ma=T.find(".js-quote-types-dropdown"),na=T.find(".js-quote-types-dropdown-ul"),oa=T.find(".js-dropdown-text-input"),pa=void 0,qa=void 0,ra=function(a,b,c,d,e,f){return{title:a,gaAction:b,$wrapper:c,link:d,renderRowFunction:e,itemsLimit:f}},sa="/search/",ta={recent:ra(a.texts.recentSearchText,"",ia,null,H,5),popular:ra(a.texts.popularSearchText,"",ia,null,H,5),news:ra(a.texts.newsSearchText,"News",ja,sa+"?tab=news&",I,2),analysis:ra(a.texts.analysisSearchText,"Analysis",ja,sa+"?tab=articles&",I,2),economicEvents:ra(a.texts.economicEventsSearchText,"Economic Events",ja,sa+"?tab=ec_event&",J,2),tools:ra(a.texts.toolsSearchText,"Tools",ja,sa+"?tab=tools&",J,3),authors:ra(a.texts.authorsSearchText,"Authors",ja,sa+"?tab=authors&",J,1),webinars:ra(a.texts.webinarsSearchText,"Webinars",ja,sa+"?tab=webinars&",J,2)},ua=["webinars"],va={news:"news",articles:"analysis",ec_event:"economicEvents",tools:"tools",authors:"authors",webinars:"webinars"},wa=$(window.document),xa=-1,ya=5,za=4,Aa=!1,Ba=!1,Ca=!0,Da="All",Ea=V.val().trim(),Fa=$.debounce(o,500),Ga=new DeepMap,Ha=new IdStorage,Ia=void 0,Ja="/search/service/logSearch";S(),window.boldifyQueryIfNeeded=m,window.saveItemToRecentSearches=w,window.makeSearchGAFunc=Q}(window.topBarSearchData);/**|**/